<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>__SEO_TITLE__</title>
    <meta name="description" content="__SEO_DESCRIPTION__" />
    <meta
      name="keywords"
      content="ë¡œë˜ í™•ë¥  ì‹¤í—˜, ë¡œë˜ ë²ˆí˜¸ ì„ íƒ ë³´ì¡°, í†µê³„ ê¸°ë°˜ ë²ˆí˜¸ ì„ íƒ, LottoGoGo"
    />
    <meta
      name="robots"
      content="index,follow,max-image-preview:large,max-snippet:-1,max-video-preview:-1"
    />
    <meta name="author" content="LottoGoGo" />
    <link rel="canonical" href="__SEO_CANONICAL_URL__" />
    <link rel="sitemap" type="application/xml" title="Sitemap" href="__SEO_SITEMAP_URL__" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="ko_KR" />
    <meta property="og:site_name" content="LottoGoGo" />
    <meta property="og:title" content="__SEO_TITLE__" />
    <meta property="og:description" content="__SEO_DESCRIPTION__" />
    <meta property="og:url" content="__SEO_CANONICAL_URL__" />
    __SEO_OG_IMAGE_META__
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="__SEO_TITLE__" />
    <meta name="twitter:description" content="__SEO_DESCRIPTION__" />
    __SEO_TWITTER_IMAGE_META__
    __SEO_GOOGLE_SITE_VERIFICATION_META__
    __SEO_NAVER_SITE_VERIFICATION_META__
    <script type="application/ld+json">
      __SEO_STRUCTURED_DATA_JSON__
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@500;700;800&family=IBM+Plex+Sans+KR:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-0: #05070d;
        --bg-1: #0a1020;
        --bg-2: #131a2b;
        --surface: rgba(15, 21, 35, 0.76);
        --surface-strong: rgba(21, 30, 49, 0.95);
        --line: rgba(255, 255, 255, 0.12);
        --line-strong: rgba(255, 255, 255, 0.22);
        --text: #f5f8ff;
        --muted: #a8b3cf;
        --brand: #0dd2a0;
        --brand-2: #41f3c6;
        --accent: #ff8c66;
        --warning: #ff7b7b;
        --good: #29d49a;
        --focus: rgba(13, 210, 160, 0.5);
        --glass-shadow: 0 16px 44px rgba(0, 0, 0, 0.42);
        --hero-gradient: linear-gradient(120deg, #41f3c6 0%, #0dd2a0 35%, #ff8c66 100%);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        min-height: 100%;
      }

      body {
        font-family: "IBM Plex Sans KR", sans-serif;
        color: var(--text);
        background: radial-gradient(circle at 18% 18%, #19385c 0%, transparent 44%),
          radial-gradient(circle at 82% 11%, #352146 0%, transparent 41%),
          radial-gradient(circle at 50% 78%, #1c2f2f 0%, transparent 48%),
          linear-gradient(160deg, var(--bg-0) 0%, var(--bg-1) 56%, var(--bg-2) 100%);
        overflow-x: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: -1;
        background-image: radial-gradient(rgba(255, 255, 255, 0.12) 0.4px, transparent 0.4px);
        background-size: 4px 4px;
        opacity: 0.08;
      }

      .orb-layer {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: -1;
      }

      .orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(72px);
        opacity: 0.3;
        animation: drift 16s ease-in-out infinite;
      }

      .orb.one {
        width: 420px;
        height: 420px;
        left: -90px;
        top: -90px;
        background: #36dfb7;
      }

      .orb.two {
        width: 360px;
        height: 360px;
        right: -120px;
        top: 80px;
        background: #5e6dff;
        animation-delay: -6s;
      }

      .orb.three {
        width: 420px;
        height: 420px;
        right: 22%;
        bottom: -180px;
        background: #ff8c66;
        animation-delay: -11s;
      }

      @keyframes drift {
        0%,
        100% {
          transform: translate3d(0, 0, 0) scale(1);
        }
        50% {
          transform: translate3d(32px, -28px, 0) scale(1.14);
        }
      }

      .shell {
        width: min(1140px, 100% - 2rem);
        margin: 0 auto;
        padding: 1.15rem 0 3.2rem;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.55rem 0.35rem;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 0.58rem;
        font-family: "Outfit", sans-serif;
        font-weight: 700;
        font-size: 1.13rem;
      }

      .brand-mark {
        width: 34px;
        height: 34px;
        border-radius: 10px;
        display: grid;
        place-items: center;
        background: linear-gradient(150deg, rgba(13, 210, 160, 0.28), rgba(255, 140, 102, 0.3));
        border: 1px solid rgba(255, 255, 255, 0.26);
      }

      .header-nav {
        display: flex;
        gap: 0.85rem;
      }

      .header-nav a {
        color: var(--muted);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .header-nav a:hover {
        color: #ffffff;
      }

      .panel {
        position: relative;
        border: 1px solid var(--line);
        background: linear-gradient(170deg, rgba(17, 27, 45, 0.84), rgba(8, 14, 26, 0.84));
        box-shadow: var(--glass-shadow);
        border-radius: 26px;
        backdrop-filter: blur(9px);
      }

      .hero {
        margin-top: 0.4rem;
        padding: clamp(1.4rem, 2.7vw, 2.2rem);
        display: grid;
        gap: 1.2rem;
        grid-template-columns: minmax(0, 1.15fr) minmax(0, 0.85fr);
        align-items: center;
      }

      .kicker {
        margin: 0;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        width: fit-content;
        border: 1px solid rgba(65, 243, 198, 0.42);
        background: rgba(65, 243, 198, 0.13);
        color: #8bffe1;
        border-radius: 999px;
        padding: 0.35rem 0.74rem;
        font-size: 0.79rem;
        font-weight: 700;
      }

      h1 {
        font-family: "Outfit", sans-serif;
        margin: 0.75rem 0 0.75rem;
        font-size: clamp(2rem, 4.8vw, 3.6rem);
        line-height: 1.05;
        letter-spacing: -0.02em;
      }

      .gradient {
        background: var(--hero-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .sub {
        margin: 0;
        color: var(--muted);
        font-size: clamp(0.98rem, 1.8vw, 1.08rem);
      }

      .hero-actions {
        margin-top: 1rem;
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 0.65rem;
      }

      .hero-btn {
        border: 0;
        border-radius: 14px;
        background: linear-gradient(120deg, #12d8a5, #08b68e);
        color: #012519;
        font-weight: 800;
        padding: 0.74rem 1rem;
        font-size: 0.93rem;
        cursor: pointer;
      }

      .hero-btn:hover {
        transform: translateY(-1px);
      }

      .hero-note {
        margin: 0;
        color: #d7e0ff;
        font-size: 0.86rem;
      }

      .quick-badge {
        margin-top: 0.8rem;
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.22);
        padding: 0.4rem 0.75rem;
        background: rgba(255, 255, 255, 0.06);
        color: #dce6ff;
        font-size: 0.84rem;
        font-weight: 700;
      }

      .draw {
        position: relative;
        min-height: 260px;
      }

      .ball {
        position: absolute;
        width: 66px;
        height: 66px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        font-family: "Outfit", sans-serif;
        font-size: 1.22rem;
        font-weight: 700;
        color: #fff;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.4);
        animation: floaty 3.6s ease-in-out infinite;
      }

      .ball.a {
        left: 6%;
        top: 11%;
        background: linear-gradient(160deg, #4ca7ff, #2168ce);
      }

      .ball.b {
        right: 15%;
        top: 2%;
        background: linear-gradient(160deg, #ff9f73, #dd5a31);
        animation-delay: -0.5s;
      }

      .ball.c {
        left: 0;
        bottom: 28%;
        background: linear-gradient(160deg, #8f98ff, #5f60d4);
        animation-delay: -1.2s;
      }

      .ball.d {
        right: 3%;
        bottom: 23%;
        background: linear-gradient(160deg, #3de0b3, #18a97f);
        animation-delay: -2s;
      }

      .ball.e {
        left: 30%;
        bottom: 2%;
        background: linear-gradient(160deg, #ffc165, #f39135);
        animation-delay: -1.7s;
      }

      .ball.f {
        right: 36%;
        top: 40%;
        background: linear-gradient(160deg, #ff7fa4, #e05282);
        animation-delay: -0.9s;
      }

      @keyframes floaty {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-12px);
        }
      }

      .generator {
        margin-top: 1rem;
        padding: 1.15rem;
      }

      .generator-head {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        gap: 0.8rem;
      }

      .generator-head h2,
      .results-head h2 {
        margin: 0;
        font-family: "Outfit", sans-serif;
        font-size: clamp(1.25rem, 2.5vw, 1.55rem);
      }

      .generator-head p,
      .results-head p {
        margin: 0;
        color: var(--muted);
        font-size: 0.89rem;
      }

      .control-wrap {
        margin-top: 0.9rem;
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 0.75rem;
      }

      .control-card {
        border-radius: 18px;
        border: 1px solid var(--line);
        background: rgba(255, 255, 255, 0.04);
        padding: 0.78rem;
      }

      .label {
        margin-bottom: 0.4rem;
        display: block;
        font-weight: 700;
        font-size: 0.85rem;
        color: #dfebff;
      }

      .seg {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.35rem;
      }

      .seg button {
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(255, 255, 255, 0.02);
        color: #dbe7ff;
        border-radius: 12px;
        padding: 0.56rem 0.58rem;
        cursor: pointer;
        font-weight: 700;
        font-size: 0.84rem;
      }

      .seg button:hover {
        border-color: var(--line-strong);
      }

      .seg button.is-active {
        border-color: rgba(13, 210, 160, 0.55);
        background: linear-gradient(120deg, rgba(13, 210, 160, 0.22), rgba(65, 243, 198, 0.12));
        color: #c5ffef;
      }

      details {
        border: 1px solid var(--line);
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.03);
        padding: 0.56rem 0.68rem;
      }

      summary {
        cursor: pointer;
        font-weight: 700;
        color: #deebff;
        font-size: 0.86rem;
      }

      .advanced {
        margin-top: 0.62rem;
      }

      .advanced input {
        width: 100%;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(7, 12, 24, 0.76);
        color: #fff;
        border-radius: 10px;
        padding: 0.56rem 0.62rem;
        font: inherit;
      }

      .advanced input:focus {
        outline: 2px solid var(--focus);
        border-color: transparent;
      }

      .action-row {
        margin-top: 0.8rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.58rem;
      }

      .btn {
        border: 0;
        border-radius: 13px;
        cursor: pointer;
        font-weight: 800;
        font-size: 0.9rem;
        padding: 0.7rem 0.95rem;
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
      }

      .btn-main {
        background: var(--hero-gradient);
        color: #0f1324;
      }

      .btn-sub {
        background: rgba(255, 255, 255, 0.06);
        color: #ecf1ff;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .btn:disabled {
        opacity: 0.66;
        cursor: progress;
      }

      .spinner {
        width: 15px;
        height: 15px;
        border: 2px solid rgba(15, 19, 36, 0.3);
        border-top-color: #0f1324;
        border-radius: 50%;
        animation: spin 0.9s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .status {
        min-height: 1.25rem;
        margin-top: 0.5rem;
        font-size: 0.86rem;
        color: #ffb9a5;
        font-weight: 600;
      }

      .results {
        margin-top: 1rem;
        padding: 1.1rem;
      }

      .results-head {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 0.7rem;
      }

      .insight {
        margin-top: 0.7rem;
        border-radius: 14px;
        border: 1px solid rgba(13, 210, 160, 0.35);
        background: rgba(13, 210, 160, 0.12);
        color: #c4ffef;
        font-size: 0.86rem;
        font-weight: 700;
        padding: 0.52rem 0.7rem;
      }

      .cards {
        margin-top: 0.85rem;
        display: grid;
        gap: 0.7rem;
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .result-card {
        border: 1px solid var(--line);
        border-radius: 18px;
        background: var(--surface-strong);
        padding: 0.78rem;
        display: grid;
        gap: 0.62rem;
        transform: translateY(14px);
        opacity: 0;
        animation: card-in 0.45s ease forwards;
      }

      @keyframes card-in {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .card-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .rank {
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.1);
        padding: 0.18rem 0.55rem;
        font-family: "Outfit", sans-serif;
        font-size: 0.8rem;
        font-weight: 700;
      }

      .score-pill {
        border-radius: 999px;
        background: rgba(41, 212, 154, 0.14);
        color: #9affd8;
        border: 1px solid rgba(41, 212, 154, 0.35);
        padding: 0.2rem 0.52rem;
        font-size: 0.76rem;
        font-weight: 700;
      }

      .number-line {
        display: flex;
        flex-wrap: wrap;
        gap: 0.36rem;
      }

      .num {
        width: 38px;
        height: 38px;
        border-radius: 999px;
        display: grid;
        place-items: center;
        font-family: "Outfit", sans-serif;
        font-weight: 700;
        font-size: 0.92rem;
        color: #fff;
      }

      .range-1 {
        background: linear-gradient(160deg, #5ab1ff, #1f72dd);
      }

      .range-2 {
        background: linear-gradient(160deg, #12d9a7, #0e9f7d);
      }

      .range-3 {
        background: linear-gradient(160deg, #fbbf5d, #dd7c2a);
      }

      .range-4 {
        background: linear-gradient(160deg, #fa8cb3, #cf4f7c);
      }

      .range-5 {
        background: linear-gradient(160deg, #8d96ff, #595bdb);
      }

      .meta {
        display: grid;
        gap: 0.45rem;
      }

      .meta-group {
        display: flex;
        gap: 0.36rem;
        flex-wrap: wrap;
      }

      .chip {
        border-radius: 999px;
        font-size: 0.74rem;
        font-weight: 700;
        line-height: 1;
        padding: 0.34rem 0.52rem;
      }

      .chip.tag {
        background: rgba(255, 140, 102, 0.17);
        border: 1px solid rgba(255, 140, 102, 0.33);
        color: #ffc5b0;
      }

      .chip.reason {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.16);
        color: #e5eeff;
      }

      .meta-title {
        font-size: 0.76rem;
        font-weight: 700;
        color: #9ab0d7;
      }

      .empty {
        margin-top: 0.8rem;
        border-radius: 16px;
        border: 1px dashed rgba(255, 255, 255, 0.24);
        padding: 1.1rem;
        color: #c8d7f9;
        text-align: center;
        font-size: 0.9rem;
      }

      .cta {
        margin-top: 1rem;
        padding: 1.1rem;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 0.8rem;
      }

      .cta p {
        margin: 0;
        font-size: 0.95rem;
        color: #dce6ff;
        font-weight: 600;
      }

      .pay {
        text-decoration: none;
        color: #0f1222;
        background: linear-gradient(120deg, #ffab7e, #ff8053);
        border-radius: 12px;
        padding: 0.68rem 1rem;
        font-weight: 900;
      }

      .notice {
        margin-top: 1rem;
        padding: 1rem 1.1rem;
      }

      .notice h3 {
        margin: 0 0 0.6rem;
        font-family: "Outfit", sans-serif;
      }

      .notice ul {
        margin: 0;
        padding-left: 1rem;
        color: #bfcae4;
      }

      .notice li + li {
        margin-top: 0.35rem;
      }

      :focus-visible {
        outline: 2px solid var(--focus);
        outline-offset: 2px;
      }

      @media (max-width: 980px) {
        .hero {
          grid-template-columns: 1fr;
        }

        .draw {
          min-height: 220px;
          order: -1;
        }

        .control-wrap {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 760px) {
        .shell {
          width: min(1140px, 100% - 1rem);
        }

        .header {
          padding-inline: 0.1rem;
        }

        .header-nav {
          display: none;
        }

        .cards {
          grid-template-columns: 1fr;
        }

        .hero {
          border-radius: 22px;
        }

        .panel {
          border-radius: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="orb-layer" aria-hidden="true">
      <div class="orb one"></div>
      <div class="orb two"></div>
      <div class="orb three"></div>
    </div>

    <main class="shell">
      <header class="header">
        <div class="brand">
          <span class="brand-mark">ğŸ±</span>
          <span>LottoGoGo</span>
        </div>
        <nav class="header-nav">
          <a href="#generate">ë²ˆí˜¸ ìƒì„±</a>
          <a href="#results">ì¶”ì²œ ê²°ê³¼</a>
          <a href="#notice">ë©´ì±…</a>
        </nav>
      </header>

      <section class="panel hero">
        <div>
          <p class="kicker">ë¡œë˜ í†µê³„ ê¸°ë°˜ í™•ë¥  ì‹¤í—˜</p>
          <h1><span class="gradient">í™•ë¥  ì‹¤í—˜ ê¸°ë°˜</span><br />ì„ íƒ ë³´ì¡° ë„êµ¬</h1>
          <p class="sub">ë‹¹ì²¨ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¬´ê·¼ê±° ì„ íƒì„ ì œê±°í•©ë‹ˆë‹¤.</p>
          <div class="hero-actions">
            <button id="start-btn" class="hero-btn" type="button">ì´ë²ˆ ì£¼ ë²ˆí˜¸ ë°›ê¸°</button>
            <p class="hero-note">ë¬´ë£Œ Â· ë¡œê·¸ì¸ ë¶ˆí•„ìš” Â· 10ì´ˆ ë‚´ ê²°ê³¼</p>
          </div>
          <div id="percentile-badge" class="quick-badge" hidden></div>
        </div>

        <div class="draw" aria-hidden="true">
          <div class="ball a">7</div>
          <div class="ball b">12</div>
          <div class="ball c">21</div>
          <div class="ball d">33</div>
          <div class="ball e">40</div>
          <div class="ball f">45</div>
        </div>
      </section>

      <section class="panel generator" id="generate">
        <div class="generator-head">
          <h2>ë²ˆí˜¸ ìƒì„±í•˜ê¸°</h2>
          <p>í•œ ë²ˆì— 5ê°œ/10ê°œ ì¡°í•© ìƒì„±</p>
        </div>

        <div class="control-wrap">
          <div class="control-card">
            <label class="label">Preset ì„ íƒ</label>
            <div class="seg" id="preset-seg">
              <button type="button" class="is-active" data-preset="A">A Â· ë³´ìˆ˜ì </button>
              <button type="button" data-preset="B">B Â· ê³µê²©ì </button>
            </div>
          </div>

          <div class="control-card">
            <label class="label">ê²Œì„ ìˆ˜</label>
            <div class="seg" id="games-seg">
              <button type="button" class="is-active" data-games="5">5ê²Œì„</button>
              <button type="button" data-games="10">10ê²Œì„</button>
            </div>
          </div>

        </div>

        <div class="action-row">
          <button class="btn btn-main" id="run-btn" type="button">
            <span id="run-icon">ğŸ²</span>
            <span id="run-text">ì¶”ì²œ ë°›ê¸°</span>
          </button>
          <button class="btn btn-sub" id="retry-btn" type="button">ë‹¤ì‹œ ì¶”ì²œ</button>
        </div>

        <div id="status" class="status"></div>
      </section>

      <section class="panel results" id="results">
        <div class="results-head">
          <h2>ì¶”ì²œ ê²°ê³¼</h2>
          <p id="result-count">ì•„ì§ ì¶”ì²œ ì „</p>
        </div>

        <div id="result-insight" class="insight" hidden></div>

        <div id="result-empty" class="empty">ì•„ì§ ì¶”ì²œ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì¶”ì²œì„ ì‹¤í–‰í•˜ì„¸ìš”.</div>
        <div id="result-cards" class="cards" aria-live="polite"></div>
      </section>

      <section class="panel cta">
        <p>ì´ ì‹¤í—˜ì´ ê´œì°®ì•˜ë‹¤ë©´ ì»¤í”¼ í•œ ì”ìœ¼ë¡œ ê³„ì† ì‹¤í—˜í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ì„¸ìš” â˜•</p>
        <a class="pay" href="__DONATE_URL__" target="_blank" rel="noopener noreferrer">ì»¤í”¼ í•œ ì” í›„ì›í•˜ê¸°</a>
      </section>

      <section class="panel notice" id="notice">
        <h3>ë©´ì±…</h3>
        <ul>
          <li>í†µê³„/ì‹¤í—˜ ëª©ì ì…ë‹ˆë‹¤.</li>
          <li>ë‹¹ì²¨ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
          <li>êµ¬ë§¤ íŒë‹¨ì€ ì‚¬ìš©ì ì±…ì„ì…ë‹ˆë‹¤.</li>
        </ul>
      </section>
    </main>

    <script>
      const state = {
        preset: "A",
        games: 5,
      };

      const MODEL_URL = "__MODEL_URL__";
      const WORKER_URL = "/assets/recommend-worker.js";
      const RECENT_STORAGE_KEY = "lottogogo_recent_combos_v1";
      const RECENT_STORAGE_LIMIT = 120;

      const TAG_LABELS = {
        hmm_hot: "AI íë¦„ ê°•ì„¸",
        hot: "ìµœê·¼ ë¹ˆë„ ìƒìŠ¹",
        carryover: "ì§ì „ íšŒì°¨ ì—°ê²°",
        carryover2: "ìµœê·¼ íë¦„ ì—°ì¥",
        neighbor: "ì¸ì ‘ íŒ¨í„´ í™•ì¥",
        reverse: "ë°˜ì „ ëŒ€ì¹­ í›„ë³´",
        hmm_cold: "ì ë³µ êµ¬ê°„ ë°˜ë“±",
        cold: "ì €ì¶œí˜„ ë°˜ë“±",
        pattern: "ë°ì´í„° íŒ¨í„´ í†µê³¼",
      };

      const elements = {
        startBtn: document.getElementById("start-btn"),
        presetSeg: document.getElementById("preset-seg"),
        gamesSeg: document.getElementById("games-seg"),
        runBtn: document.getElementById("run-btn"),
        runIcon: document.getElementById("run-icon"),
        runText: document.getElementById("run-text"),
        retryBtn: document.getElementById("retry-btn"),
        status: document.getElementById("status"),
        badge: document.getElementById("percentile-badge"),
        resultCount: document.getElementById("result-count"),
        resultInsight: document.getElementById("result-insight"),
        resultEmpty: document.getElementById("result-empty"),
        resultCards: document.getElementById("result-cards"),
      };

      let engineWorker = null;
      let workerReady = false;
      let modelPromise = null;
      let requestSeq = 0;
      const pendingRequests = new Map();

      elements.startBtn.addEventListener("click", () => {
        document.getElementById("generate").scrollIntoView({ behavior: "smooth", block: "start" });
      });

      elements.presetSeg.addEventListener("click", (event) => {
        const target = event.target;
        if (!(target instanceof HTMLButtonElement)) return;
        const preset = target.dataset.preset;
        if (!preset) return;
        state.preset = preset;
        for (const button of elements.presetSeg.querySelectorAll("button")) {
          button.classList.toggle("is-active", button === target);
        }
      });

      elements.gamesSeg.addEventListener("click", (event) => {
        const target = event.target;
        if (!(target instanceof HTMLButtonElement)) return;
        const games = target.dataset.games;
        if (!games) return;
        state.games = Number(games);
        for (const button of elements.gamesSeg.querySelectorAll("button")) {
          button.classList.toggle("is-active", button === target);
        }
      });

      elements.runBtn.addEventListener("click", () => requestRecommend());
      elements.retryBtn.addEventListener("click", () => requestRecommend());

      setStatus("ëª¨ë¸ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...");
      bootstrapEngine();

      async function bootstrapEngine() {
        try {
          await ensureWorkerReady();
          setStatus("ì¤€ë¹„ ì™„ë£Œ. ì¶”ì²œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¦‰ì‹œ ìƒì„±í•©ë‹ˆë‹¤.");
        } catch (error) {
          setStatus(
            error instanceof Error
              ? `ëª¨ë¸ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`
              : "ëª¨ë¸ ì´ˆê¸°í™” ì‹¤íŒ¨"
          );
        }
      }

      async function requestRecommend() {
        setLoading(true);
        setStatus("ì¡°í•© ìƒì„± ì¤‘ì…ë‹ˆë‹¤...");

        try {
          await ensureWorkerReady();
          const result = await generateWithWorker({
            preset: state.preset,
            games: state.games,
            recentKeys: readRecentKeys(),
          });
          renderResult(result);
          saveRecentKeysFromResult(result);
          const attempts = Number(result?.debug?.attempts || 0);
          setStatus(
            attempts > 0
              ? `ì¶”ì²œ ê²°ê³¼ë¥¼ ê°±ì‹ í–ˆìŠµë‹ˆë‹¤. (${attempts.toLocaleString("ko-KR")}íšŒ íƒìƒ‰)`
              : "ì¶”ì²œ ê²°ê³¼ë¥¼ ê°±ì‹ í–ˆìŠµë‹ˆë‹¤."
          );
        } catch (error) {
          setStatus(
            error instanceof Error
              ? `ì§€ê¸ˆì€ ê²°ê³¼ë¥¼ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${error.message}`
              : "ì§€ê¸ˆì€ ê²°ê³¼ë¥¼ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤"
          );
        } finally {
          setLoading(false);
        }
      }

      async function ensureWorkerReady() {
        if (workerReady && engineWorker) return;
        if (!engineWorker) {
          engineWorker = new Worker(WORKER_URL);
          engineWorker.addEventListener("message", onWorkerMessage);
          engineWorker.addEventListener("error", onWorkerError);
        }

        const model = await loadModel();
        const initResult = await sendWorkerRequest("init", { model }, 12000);
        if (!initResult || initResult.type !== "inited") {
          throw new Error("worker initialization failed");
        }
        workerReady = true;
      }

      function onWorkerMessage(event) {
        const message = event.data || {};
        const requestId = message.requestId;
        if (!requestId) return;

        const pending = pendingRequests.get(requestId);
        if (!pending) return;

        pendingRequests.delete(requestId);
        window.clearTimeout(pending.timerId);

        if (message.type === "error") {
          pending.reject(new Error(message.message || "worker error"));
          return;
        }

        pending.resolve(message);
      }

      function onWorkerError(event) {
        for (const pending of pendingRequests.values()) {
          window.clearTimeout(pending.timerId);
          pending.reject(new Error(event?.message || "worker crashed"));
        }
        pendingRequests.clear();
      }

      async function generateWithWorker(payload) {
        const message = await sendWorkerRequest("generate", payload, 20000);
        if (message.type !== "result" || !message.payload) {
          throw new Error("worker result payload is invalid");
        }
        return message.payload;
      }

      function sendWorkerRequest(type, payload, timeoutMs) {
        if (!engineWorker) {
          return Promise.reject(new Error("worker not ready"));
        }

        const requestId = `${type}-${Date.now()}-${requestSeq++}`;
        return new Promise((resolve, reject) => {
          const timerId = window.setTimeout(() => {
            pendingRequests.delete(requestId);
            reject(new Error("ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."));
          }, timeoutMs);

          pendingRequests.set(requestId, { resolve, reject, timerId });
          engineWorker.postMessage({ type, requestId, ...payload });
        });
      }

      async function loadModel() {
        if (modelPromise) return modelPromise;

        modelPromise = fetch(MODEL_URL, { cache: "no-store" }).then(async (response) => {
          if (!response.ok) {
            throw new Error(`model.json ë¡œë“œ ì‹¤íŒ¨ (${response.status})`);
          }

          const parsed = await response.json();
          if (!parsed || typeof parsed !== "object" || !parsed.presets) {
            throw new Error("model.json í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          }
          return parsed;
        });

        return modelPromise;
      }

      function readRecentKeys() {
        try {
          const raw = window.localStorage.getItem(RECENT_STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed.map((value) => String(value)).slice(0, RECENT_STORAGE_LIMIT);
        } catch (_error) {
          return [];
        }
      }

      function saveRecentKeysFromResult(data) {
        const rows = Array.isArray(data?.recommendations) ? data.recommendations : [];
        if (!rows.length) return;

        const existing = readRecentKeys();
        const merged = [...existing];

        for (const row of rows) {
          const numbers = Array.isArray(row?.numbers) ? row.numbers.map((value) => Number(value)) : [];
          if (numbers.length !== 6 || numbers.some((value) => !Number.isFinite(value))) continue;
          const key = numbers.join("-");
          merged.unshift(key);
        }

        const unique = [...new Set(merged)].slice(0, RECENT_STORAGE_LIMIT);
        try {
          window.localStorage.setItem(RECENT_STORAGE_KEY, JSON.stringify(unique));
        } catch (_error) {
          // Ignore localStorage quota errors.
        }
      }

      function renderResult(data) {
        const rows = Array.isArray(data?.recommendations) ? data.recommendations : [];

        if (!rows.length) {
          elements.resultCards.innerHTML = "";
          elements.resultEmpty.hidden = false;
          elements.resultCount.textContent = "ì¶”ì²œ ê²°ê³¼ ì—†ìŒ";
          elements.resultInsight.hidden = true;
          elements.badge.hidden = true;
          return;
        }

        const percentile = data?.meta?.percentile;
        if (typeof percentile === "number") {
          elements.badge.hidden = false;
          elements.badge.textContent = `ì´ë²ˆ ì„¤ì •: ê³¼ê±° ê¸°ì¤€ ìƒìœ„ ${percentile}%`;
          elements.resultInsight.hidden = false;
          elements.resultInsight.textContent = `í˜„ì¬ ì„¤ì •ì€ ê³¼ê±° ë°ì´í„° ê¸°ì¤€ ìƒìœ„ ${percentile}% êµ¬ê°„ì˜ ì•ˆì •ì„±ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.`;
        } else {
          elements.badge.hidden = true;
          elements.resultInsight.hidden = true;
          elements.resultInsight.textContent = "";
        }

        const scores = rows.map((item) => Number(item.score ?? 0));
        const minScore = Math.min(...scores);
        const maxScore = Math.max(...scores);

        elements.resultCount.textContent = `${rows.length}ê°œ ì¶”ì²œ ì™„ë£Œ`;
        elements.resultEmpty.hidden = true;

        elements.resultCards.innerHTML = rows
          .map((item, index) => {
            const numbers = Array.isArray(item.numbers) ? item.numbers : [];
            const score = Number(item.score ?? 0);
            const scorePoint = normalizeScore(score, minScore, maxScore);
            const tags = formatTags(item.tags);
            const reasons = formatReasons(item.reasons);

            return `
              <article class="result-card" style="animation-delay:${index * 60}ms">
                <div class="card-top">
                  <span class="rank">ì¶”ì²œ ${index + 1}</span>
                  <span class="score-pill">ì¶”ì²œì§€ìˆ˜ ${scorePoint}</span>
                </div>

                <div class="number-line">
                  ${numbers.map((number) => renderBall(number)).join("")}
                </div>

                <div class="meta">
                  <div>
                    <div class="meta-title">ì¶”ì²œ í¬ì¸íŠ¸</div>
                    <div class="meta-group">
                      ${tags.map((tag) => `<span class="chip tag">${escapeHtml(tag)}</span>`).join("")}
                    </div>
                  </div>

                  <div>
                    <div class="meta-title">ì„ ì • ê·¼ê±°</div>
                    <div class="meta-group">
                      ${reasons.map((reason) => `<span class="chip reason">${escapeHtml(reason)}</span>`).join("")}
                    </div>
                  </div>
                </div>
              </article>
            `;
          })
          .join("");
      }

      function formatTags(rawTags) {
        const tags = Array.isArray(rawTags) ? rawTags : [];
        const labels = tags.map((tag) => TAG_LABELS[tag] || "ë°ì´í„° íŒ¨í„´ í†µê³¼");
        const unique = [...new Set(labels)].slice(0, 3);
        return unique.length ? unique : ["ë°ì´í„° íŒ¨í„´ í†µê³¼"];
      }

      function formatReasons(rawReasons) {
        const reasons = Array.isArray(rawReasons) ? rawReasons : [];
        const mapped = reasons.map((reason) => toFriendlyReason(reason));
        const unique = [...new Set(mapped)].slice(0, 3);
        return unique.length ? unique : ["í†µê³„ í•„í„°ë¥¼ í†µê³¼í•œ ì¡°í•©"];
      }

      function toFriendlyReason(reasonText) {
        const value = String(reasonText || "");

        if (value.startsWith("AC>=")) return "ë²ˆí˜¸ ê°„ ê°„ê²© ë‹¤ì–‘ì„± í™•ë³´";
        if (value.startsWith("sum ")) return "ì´í•© ë°¸ëŸ°ìŠ¤ êµ¬ê°„ ìœ ì§€";
        if (value.startsWith("zone<=")) return "êµ¬ê°„ ì ë¦¼ ì™„í™”";
        if (value.startsWith("odd ")) return "í™€ì§ ë¹„ìœ¨ ê· í˜•";
        if (value.startsWith("high ")) return "ê³ ì € ë¹„ìœ¨ ê· í˜•";
        if (value.includes("history overlap")) return "ê³¼ê±° ê³ ì¤‘ë³µ ì¡°í•© ë°°ì œ";
        if (value.startsWith("carryover<=")) return "ìµœê·¼ íšŒì°¨ ê³¼ë°˜ì˜ ë°©ì§€";

        return "í•µì‹¬ í•„í„° ì¡°ê±´ ì¶©ì¡±";
      }

      function renderBall(number) {
        const n = Number(number);
        if (!Number.isFinite(n)) return "";

        return `<span class="num ${getRangeClass(n)}">${escapeHtml(String(n))}</span>`;
      }

      function getRangeClass(number) {
        if (number <= 10) return "range-1";
        if (number <= 20) return "range-2";
        if (number <= 30) return "range-3";
        if (number <= 40) return "range-4";
        return "range-5";
      }

      function normalizeScore(score, minScore, maxScore) {
        if (!Number.isFinite(score)) return 70;
        if (maxScore <= minScore) return 82;

        const ratio = (score - minScore) / (maxScore - minScore);
        return Math.round(68 + ratio * 30);
      }

      function escapeHtml(value) {
        return String(value)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#39;");
      }

      function setStatus(message) {
        elements.status.textContent = message;
      }

      function setLoading(loading) {
        elements.runBtn.disabled = loading;
        elements.retryBtn.disabled = loading;

        if (loading) {
          elements.runIcon.innerHTML = '<span class="spinner" aria-hidden="true"></span>';
          elements.runText.textContent = "ìƒì„± ì¤‘...";
        } else {
          elements.runIcon.textContent = "ğŸ²";
          elements.runText.textContent = "ì¶”ì²œ ë°›ê¸°";
        }
      }
    </script>
  </body>
</html>
