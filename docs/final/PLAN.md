# LottoGoGo 실행 계획 (통합본)

> **Version:** 1.0.0 Final  
> **최종 병합일:** 2026-02-08

---

## 1. MVP 범위

### 핵심 기능 (MVP Scope)
- CSV 기반 과거 로또 데이터 로딩 및 검증
- 베이지안 기반 번호별 점수 계산 엔진
- Boost/Penalty 휴리스틱 레이어
- 몬테카를로 샘플링 기반 조합 생성
- 필수 필터 파이프라인 (합계, AC값, 구간분산, 끝수, 홀짝, 고저, 과거당첨)
- 조합 랭킹 및 다양성 제약 적용
- Config 기반 파라미터 관리
- 백테스터 기본 기능

### MVP 제외 항목
- Web UI / API 엔드포인트
- 실시간 데이터 크롤링
- 사용자 인증/권한 관리
- 다국어 지원

---

## 2. Epic / Story / Task

### Epic 1: 데이터 레이어
| ID | Story | Task | 예상 시간 |
|----|-------|------|-----------|
| E1-S1 | CSV 데이터 로더 | T1: CSV 파서 구현 | 2h |
| | | T2: 데이터 검증 로직 | 2h |
| | | T3: 회차별 인덱싱 | 1h |
| E1-S2 | Config 관리자 | T1: YAML/JSON 파서 | 1h |
| | | T2: 기본값 설정 | 1h |
| | | T3: 검증 로직 | 1h |

### Epic 2: 점수 엔진 (핵심)
| ID | Story | Task | 예상 시간 |
|----|-------|------|-----------|
| E2-S1 | BaseScore 계산 | T1: Beta Distribution 구현 | 3h |
| | | T2: 베이지안 업데이트 | 2h |
| E2-S2 | Boost 레이어 | T1: Hot/Cold 판정 | 2h |
| | | T2: Neighbor/Carryover | 2h |
| | | T3: Reverse 관계 | 1h |
| E2-S3 | Penalty 레이어 | T1: Poisson Penalty | 3h |
| | | T2: Markov Penalty | 3h |
| | | T3: Ensemble 합산 | 1h |
| E2-S4 | 확률 변환 | T1: Softmax 정규화 | 1h |
| | | T2: Floor 적용 | 1h |

### Epic 3: 조합 생성기
| ID | Story | Task | 예상 시간 |
|----|-------|------|-----------|
| E3-S1 | 몬테카를로 샘플러 | T1: 가중치 샘플링 | 3h |
| | | T2: 중복 제거 | 1h |
| | | T3: 대량 생성 최적화 | 2h |

### Epic 4: 필터 파이프라인
| ID | Story | Task | 예상 시간 |
|----|-------|------|-----------|
| E4-S1 | 개별 필터 구현 | T1: 합계 필터 (100-175) | 1h |
| | | T2: AC값 필터 (≥7) | 1h |
| | | T3: 구간분산 필터 | 1h |
| | | T4: 끝수 필터 (≤2) | 1h |
| | | T5: 홀짝 필터 (2:4~4:2) | 1h |
| | | T6: 고저 균형 필터 | 1h |
| | | T7: 과거 당첨 필터 | 2h |
| E4-S2 | 파이프라인 조합 | T1: 체인 실행기 | 2h |
| | | T2: 탈락 사유 로깅 | 1h |

### Epic 5: 랭킹 & 다양성
| ID | Story | Task | 예상 시간 |
|----|-------|------|-----------|
| E5-S1 | 조합 점수 계산 | T1: 합산 점수 계산 | 1h |
| E5-S2 | 다양성 제약 | T1: 교집합 검사 | 2h |
| | | T2: 중복 조합 제거 | 1h |

### Epic 6: 백테스터
| ID | Story | Task | 예상 시간 |
|----|-------|------|-----------|
| E6-S1 | 워크포워드 엔진 | T1: 테스트 루프 구현 | 3h |
| | | T2: 기준선 생성기 | 1h |
| E6-S2 | 지표 계산 | T1: P(match≥3) 계산 | 2h |
| | | T2: 보조 지표 | 1h |
| | | T3: 리포트 생성 | 2h |

---

## 3. 우선순위 (Sprint 배치)

### Sprint 1 (Week 1-2): 기반 구축
- [P0] E1-S1: CSV 데이터 로더
- [P0] E1-S2: Config 관리자
- [P0] E2-S1: BaseScore 계산

### Sprint 2 (Week 3-4): 점수 엔진 완성
- [P0] E2-S2: Boost 레이어
- [P0] E2-S3: Penalty 레이어
- [P0] E2-S4: 확률 변환

### Sprint 3 (Week 5-6): 조합 생성 & 필터
- [P0] E3-S1: 몬테카를로 샘플러
- [P0] E4-S1: 개별 필터 구현
- [P1] E4-S2: 파이프라인 조합

### Sprint 4 (Week 7-8): 마무리
- [P1] E5-S1: 조합 점수 계산
- [P1] E5-S2: 다양성 제약
- [P1] E6-S1: 워크포워드 엔진
- [P2] E6-S2: 지표 계산

---

## 4. 리스크 분석

| 리스크 | 영향도 | 발생확률 | 대응 방안 |
|--------|--------|----------|-----------|
| 베이지안 모델 성능 미달 | 높음 | 중간 | 하이퍼파라미터 그리드 서치, Prior 조정 |
| 몬테카를로 샘플링 속도 저하 | 중간 | 중간 | NumPy 벡터화, 병렬 처리 도입 |
| 필터 조건 너무 엄격 | 중간 | 높음 | Config 기반 조건 완화 옵션 |
| 백테스트 과적합 | 높음 | 중간 | Holdout 세트 분리, 교차검증 |
| CSV 데이터 품질 이슈 | 중간 | 낮음 | 데이터 검증 단계 강화 |
| 재현성 보장 실패 | 높음 | 낮음 | 모든 랜덤 연산에 seed 고정 |

### 리스크 완화 전략
1. **조기 백테스트**: Sprint 2 종료 시점에 초기 백테스트 수행
2. **지속적 검증**: 모든 컴포넌트에 단위 테스트 필수
3. **Config 외부화**: 모든 매직 넘버 제거, Config로 관리
4. **로깅 강화**: 디버깅 용이성 확보

---

## 5. 테스트 전략

### 테스트 피라미드
```
        ┌───────────────┐
        │    E2E (5%)   │  ← 전체 파이프라인 통합
        ├───────────────┤
        │ Integration   │  ← 컴포넌트 간 연동
        │    (25%)      │
        ├───────────────┤
        │     Unit      │  ← 개별 함수/클래스
        │    (70%)      │
        └───────────────┘
```

### 핵심 테스트 10개 (Critical Path)

| # | 테스트 ID | 설명 | 검증 포인트 |
|---|-----------|------|-------------|
| 1 | UT-D001 | CSV 정상 로딩 | 회차 데이터 정확성 |
| 2 | UT-S001 | 베이지안 점수 계산 | 수학적 정확성 |
| 3 | UT-S003 | Hot 번호 판정 | 휴리스틱 정확성 |
| 4 | UT-S006 | Poisson 페널티 | 통계모델 정확성 |
| 5 | UT-G002 | 중복 없는 샘플링 | 6개 고유 번호 |
| 6 | UT-G003 | Seed 재현성 | 결정론적 결과 |
| 7 | UT-F001 | 합계 필터 | 필터 정확성 |
| 8 | IT-002 | 점수→샘플링 연동 | 데이터 흐름 |
| 9 | E2E-001 | 전체 파이프라인 | 통합 기능 |
| 10 | E2E-004 | 재현성 E2E | 전체 결정론 |

### 경계값 테스트

| 항목 | 테스트 케이스 |
|------|---------------|
| 번호 범위 | 0(실패), 1(성공), 45(성공), 46(실패) |
| 합계 필터 | 99(탈락), 100(통과), 175(통과), 176(탈락) |
| AC값 필터 | 6(탈락), 7(통과), 8(통과) |
| 홀짝 비율 | 1:5(탈락), 2:4(통과), 4:2(통과), 5:1(탈락) |

### 성능 테스트 기준

| 항목 | 목표 | 측정 방법 |
|------|------|-----------|
| 점수 계산 | < 100ms (45번호) | pytest-benchmark |
| 샘플링 100K | < 5s | time 측정 |
| 필터 파이프라인 | < 1s (100K 후보) | time 측정 |
| 전체 추천 | < 10s | E2E time |

---

## 6. 릴리즈 체크리스트

### 배포 전 체크리스트

#### 코드 품질
- [ ] 모든 단위 테스트 통과 (pytest)
- [ ] 통합 테스트 통과
- [ ] E2E 테스트 통과
- [ ] 코드 커버리지 85% 이상
- [ ] 핵심 테스트 10개 전체 통과
- [ ] 린터 경고 0개 (flake8/pylint)
- [ ] 타입 힌트 검증 (mypy)

#### 문서화
- [ ] README.md 업데이트
- [ ] API 문서 최신화
- [ ] CHANGELOG.md 작성
- [ ] 버전 번호 업데이트 (pyproject.toml)

#### 성능
- [ ] 벤치마크 테스트 통과
- [ ] 메모리 사용량 적정 (<500MB)

#### 재현성
- [ ] Seed 고정 테스트 통과
- [ ] 동일 입력 → 동일 출력 검증

---

## 7. 롤백 절차

### 롤백 트리거 조건

| 조건 | 심각도 | 대응 |
|------|--------|------|
| 핵심 기능 실패 | Critical | 즉시 롤백 |
| 성능 50% 이상 저하 | High | 4시간 내 롤백 |
| 재현성 실패 | High | 조사 후 롤백 결정 |
| 비핵심 버그 | Medium | 패치 릴리즈 |

### 롤백 명령

```bash
git checkout v0.x.x  # 이전 버전 태그
git checkout -b hotfix/rollback
```

---

## 8. 모니터링

### 핵심 메트릭

| 메트릭 | 설명 | 임계값 |
|--------|------|--------|
| 실행 성공률 | 추천 생성 성공 비율 | > 99% |
| 평균 실행 시간 | 전체 파이프라인 시간 | < 10s |
| 메모리 사용량 | 피크 메모리 | < 500MB |
| 필터 통과율 | 필터 후 남은 비율 | > 1% |

### 정기 점검
- [ ] 일간: 실행 로그 확인
- [ ] 주간: 성능 메트릭 리뷰
- [ ] 월간: 백테스트 재실행 및 비교
