# LottoGoGo Product Backlog

> **Version:** 1.0.0  
> **최종 업데이트:** 2026-02-08  
> **Sprint 기준:** 2주 단위

---

## 📋 MVP 백로그

### Epic 1: 데이터 레이어 [Sprint 1]

#### Story 1.1: CSV 데이터 로더
> 과거 로또 당첨 데이터를 CSV 파일에서 로드하고 검증한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T1.1.1 | CSV 파서 구현 | 2h | ✅ Pandas로 CSV 파싱 가능 ✅ 컬럼(round, n1~n6) 자동 인식 ✅ UTF-8 인코딩 지원 |
| T1.1.2 | 데이터 검증 로직 | 2h | ✅ 번호 범위 1~45 검증 ✅ 중복 번호 탐지 ✅ 누락 컬럼 에러 처리 |
| T1.1.3 | 회차별 인덱싱 | 1h | ✅ round_id 기준 정렬 ✅ 최근 N회차 필터링 지원 ✅ 단위 테스트 통과 |

---

#### Story 1.2: Config 관리자
> YAML/JSON 기반 설정 파일을 로드하고 기본값을 적용한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T1.2.1 | YAML/JSON 파서 | 1h | ✅ PyYAML 기반 파싱 ✅ JSON 호환 ✅ 파일 없음 시 에러 처리 |
| T1.2.2 | 기본값 설정 | 1h | ✅ 모든 파라미터에 기본값 정의 ✅ Pydantic 스키마 적용 ✅ 타입 검증 |
| T1.2.3 | 검증 로직 | 1h | ✅ 범위 검증 (예: sample_size > 0) ✅ 유효하지 않은 값 에러 ✅ 단위 테스트 통과 |

---

### Epic 2: 점수 엔진 (핵심) [Sprint 1-2]

#### Story 2.1: BaseScore 계산 [Sprint 1]
> 베이지안 기반으로 각 번호의 기본 점수를 계산한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T2.1.1 | Beta Distribution 구현 | 3h | ✅ scipy.stats.beta 활용 ✅ Prior α, β 설정 가능 ✅ Posterior Mean 계산 |
| T2.1.2 | 베이지안 업데이트 | 2h | ✅ 빈도 → α, β 업데이트 ✅ 최근 N회차 기반 계산 ✅ 수학적 정확성 검증 |

---

#### Story 2.2: Boost 레이어 [Sprint 2]
> 휴리스틱 기반 가중치를 적용한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T2.2.1 | Hot/Cold 판정 | 2h | ✅ Hot: 최근 5회 중 ≥2회 ✅ Cold: 최근 10회 중 0회 ✅ Config에서 임계값 조정 가능 |
| T2.2.2 | Neighbor/Carryover | 2h | ✅ 직전 회차 번호 ±1 탐지 ✅ Carryover 플래그 설정 ✅ 가중치 적용 |
| T2.2.3 | Reverse 관계 | 1h | ✅ 역수 관계(46-n) 판정 ✅ 가중치 적용 ✅ 단위 테스트 통과 |

---

#### Story 2.3: Penalty 레이어 [Sprint 2]
> 과출현 및 전이 확률 기반 패널티를 적용한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T2.3.1 | Poisson Penalty | 3h | ✅ 최근 출현 횟수 기반 ✅ λ1 파라미터 조정 가능 ✅ 음수 점수 방지 |
| T2.3.2 | Markov Penalty | 3h | ✅ 전이 행렬 계산 ✅ λ2 파라미터 적용 ✅ 수학적 검증 |
| T2.3.3 | Ensemble 합산 | 1h | ✅ Base + Boost - Penalty ✅ 최종 점수 정규화 ✅ 단위 테스트 통과 |

---

#### Story 2.4: 확률 변환 [Sprint 2]
> 점수를 샘플링 확률로 변환한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T2.4.1 | Softmax 정규화 | 1h | ✅ 확률 합계 = 1.0 ✅ 온도 파라미터 지원 ✅ NumPy 벡터화 |
| T2.4.2 | Floor 적용 | 1h | ✅ min_prob_floor 적용 ✅ 0 확률 방지 ✅ 재정규화 |

---

### Epic 3: 조합 생성기 [Sprint 3]

#### Story 3.1: 몬테카를로 샘플러
> 확률 기반 몬테카를로 샘플링으로 조합을 생성한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T3.1.1 | 가중치 샘플링 | 3h | ✅ np.random.choice 활용 ✅ 확률 가중치 적용 ✅ 6개 번호 선택 |
| T3.1.2 | 중복 제거 | 1h | ✅ 조합 내 중복 없음 ✅ replace=False 적용 ✅ 단위 테스트 통과 |
| T3.1.3 | 대량 생성 최적화 | 2h | ✅ 100,000개 < 5초 ✅ 메모리 < 500MB ✅ 벤치마크 통과 |

---

### Epic 4: 필터 파이프라인 [Sprint 3]

#### Story 4.1: 개별 필터 구현
> 각 필터 규칙을 독립적으로 구현한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T4.1.1 | 합계 필터 | 1h | ✅ 100 ≤ sum ≤ 175 ✅ 경계값 테스트 통과 ✅ 탈락 사유 반환 |
| T4.1.2 | AC값 필터 | 1h | ✅ AC ≥ 7 ✅ AC값 계산 로직 구현 ✅ 단위 테스트 통과 |
| T4.1.3 | 구간분산 필터 | 1h | ✅ 구간당 ≤ 3개 ✅ 4구간 분할 (1-11, 12-22, 23-33, 34-45) ✅ 검증 |
| T4.1.4 | 끝수 필터 | 1h | ✅ 동일 끝수 ≤ 2 ✅ 끝수 추출 로직 ✅ 단위 테스트 통과 |
| T4.1.5 | 홀짝 필터 | 1h | ✅ 2:4 ~ 4:2 허용 ✅ 비율 계산 ✅ 경계값 테스트 |
| T4.1.6 | 고저 균형 필터 | 1h | ✅ 고(23+):저(1-22) 균형 ✅ 허용 범위 Config화 |
| T4.1.7 | 과거 당첨 필터 | 2h | ✅ 5개 이상 일치 시 폐기 ✅ 이력 비교 로직 ✅ 성능 최적화 |

---

#### Story 4.2: 파이프라인 조합
> 필터들을 체인으로 연결하여 실행한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T4.2.1 | 체인 실행기 | 2h | ✅ 순차 필터 적용 ✅ 조기 탈락 최적화 ✅ 플러그인 패턴 |
| T4.2.2 | 탈락 사유 로깅 | 1h | ✅ 필터별 탈락 카운트 ✅ 디버그 로그 출력 ✅ 통계 집계 |

---

### Epic 5: 랭킹 & 다양성 [Sprint 4]

#### Story 5.1: 조합 점수 계산
> 필터 통과 조합의 최종 점수를 계산한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T5.1.1 | 합산 점수 계산 | 1h | ✅ combo_score = Σ raw_score ✅ 정렬 기준 적용 ✅ 상위 K개 선택 |

---

#### Story 5.2: 다양성 제약
> 추천 조합 간 다양성을 보장한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T5.2.1 | 교집합 검사 | 2h | ✅ 조합 간 교집합 계산 ✅ ≥ 4개 일치 시 제거 ✅ 임계값 Config화 |
| T5.2.2 | 중복 조합 제거 | 1h | ✅ 완전 일치 조합 제거 ✅ Set 기반 중복 검사 ✅ 최종 output_count 보장 |

---

### Epic 6: 백테스터 [Sprint 4]

#### Story 6.1: 워크포워드 엔진
> Walk-forward 방식으로 과거 데이터를 테스트한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T6.1.1 | 테스트 루프 구현 | 3h | ✅ 회차별 순차 테스트 ✅ 학습/테스트 분리 ✅ 결과 누적 |
| T6.1.2 | 기준선 생성기 | 1h | ✅ 랜덤 추천 생성기 ✅ 동일 조건 비교 ✅ Seed 고정 |

---

#### Story 6.2: 지표 계산
> 성능 지표를 계산하고 리포트를 생성한다.

| Task | 설명 | 예상 | Definition of Done |
|------|------|------|-------------------|
| T6.2.1 | P(match≥3) 계산 | 2h | ✅ 3개 이상 적중 확률 ✅ 회차별 집계 ✅ 기준선 대비 비교 |
| T6.2.2 | 보조 지표 | 1h | ✅ 평균 적중 개수 ✅ P(match≥4) ✅ 표준편차 |
| T6.2.3 | 리포트 생성 | 2h | ✅ JSON/Markdown 출력 ✅ 분포 그래프 데이터 ✅ Config 스냅샷 포함 |

---

## 🚀 Post-MVP 백로그

### Epic 7: REST API [Phase 2]

#### Story 7.1: FastAPI 서버 구축
| Task | 설명 | Definition of Done |
|------|------|-------------------|
| T7.1.1 | 프로젝트 셋업 | ✅ FastAPI + uvicorn ✅ CORS 설정 |
| T7.1.2 | 엔드포인트 구현 | ✅ POST /recommendations ✅ GET /scores ✅ POST /backtest |
| T7.1.3 | 에러 핸들링 | ✅ 표준 에러 응답 ✅ 에러 코드 체계 적용 |

---

#### Story 7.2: 인증/Rate Limit
| Task | 설명 | Definition of Done |
|------|------|-------------------|
| T7.2.1 | API Key 인증 | ✅ X-API-Key 헤더 검증 ✅ 키 발급 로직 |
| T7.2.2 | Rate Limiting | ✅ 분당 60회 제한 ✅ 429 응답 ✅ Redis 연동 |

---

### Epic 8: 웹 대시보드 [Phase 3]

#### Story 8.1: 프론트엔드 개발
| Task | 설명 | Definition of Done |
|------|------|-------------------|
| T8.1.1 | Next.js 셋업 | ✅ 프로젝트 초기화 ✅ 라우팅 구성 |
| T8.1.2 | 추천 결과 UI | ✅ 번호 시각화 ✅ 점수 breakdown 표시 |
| T8.1.3 | 백테스트 대시보드 | ✅ 차트 시각화 ✅ 성능 비교 |

---

### Epic 9: 데이터 파이프라인 [Phase 2]

#### Story 9.1: 자동 데이터 수집
| Task | 설명 | Definition of Done |
|------|------|-------------------|
| T9.1.1 | 크롤러 구현 | ✅ 동행복권 사이트 파싱 ✅ 주간 자동 실행 |
| T9.1.2 | 데이터베이스 연동 | ✅ PostgreSQL 마이그레이션 ✅ SQLAlchemy 모델 |

---

## 📊 Sprint 요약

| Sprint | 기간 | Epics | 예상 시간 |
|--------|------|-------|-----------|
| **Sprint 1** | Week 1-2 | E1 (데이터), E2-S1 (BaseScore) | 16h |
| **Sprint 2** | Week 3-4 | E2-S2,S3,S4 (점수 엔진 완성) | 19h |
| **Sprint 3** | Week 5-6 | E3 (샘플러), E4 (필터) | 19h |
| **Sprint 4** | Week 7-8 | E5 (랭킹), E6 (백테스터) | 13h |
| **Total MVP** | 8 weeks | E1-E6 | **67h** |

---

## ✅ Definition of Done (전역)

모든 Task는 다음을 충족해야 완료:

1. **코드 품질**
   - [ ] 단위 테스트 작성 및 통과
   - [ ] 타입 힌트 적용
   - [ ] Docstring 작성

2. **검증**
   - [ ] 린터 경고 0개
   - [ ] mypy 타입 체크 통과

3. **문서화**
   - [ ] 함수/클래스 문서화
   - [ ] 사용 예시 (필요 시)

4. **통합**
   - [ ] 기존 코드와 호환
   - [ ] 통합 테스트 통과 (해당 시)
